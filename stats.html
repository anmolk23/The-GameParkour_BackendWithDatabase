<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gaming Stats - The GameParkour</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div class="navbar">
    <div class="logo">
      <img src="logo.jpg" alt="logo">
      <span>The GameParkour</span>
    </div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="profile.html">Profile</a>
      <a href="collection.html">Collection</a>
      <a href="wishlist.html">Wishlist</a>
      <a href="stats.html" class="active">Stats</a>
      <a id="authLink" href="login.html">Login</a>
    </div>
  </div>

  <div class="page">
    <h2>Your Gaming Stats</h2>

    <div id="statsBox" class="grid"></div>
  </div>

  <div class="footer">© 2025 The GameParkour</div>

  <script>
  // ---------------------- LOGIN / LOGOUT UI ----------------------
  async function checkAuth() {
    const res = await fetch("/api/profile");
    const link = document.getElementById("authLink");

    if (res.status === 401) {
      // user not logged in
      link.textContent = "Login";
      link.href = "login.html";
      return;
    }

    // user is logged in → convert to LOGOUT button
    link.textContent = "Logout";
    link.href = "#";

    link.onclick = async () => {
      await fetch("/api/logout", { method: "POST" });
      window.location = "login.html";
    };
  }
  checkAuth();



  // ---------------------- LOAD STATS ----------------------
  async function loadStats() {
    try {
      const res = await fetch('/api/stats');
      if (res.status === 401) {
        window.location = 'login.html';
        return;
      }

      const data = await res.json();
      if (data.ok && data.stats) {
        const s = data.stats;

        const html = `
          <div class="card">
            <h3>Total Games Played</h3>
            <div class="stat-box">
              <span>Games</span>
              <span>${s.totalGames}</span>
            </div>
          </div>

          <div class="card">
            <h3>Total Hours Played</h3>
            <div class="stat-box">
              <span>Hours</span>
              <span>${s.totalHours} hrs</span>
            </div>
          </div>

          <div class="card">
            <h3>XP Level</h3>
            <div class="progress">
              <div class="progress-bar" style="width:${s.levelProgress || 0}%"></div>
            </div>
            <p>${s.level}</p>
          </div>

          <div class="card">
            <h3>Win Ratio</h3>
            <div class="progress">
              <div class="progress-bar" style="width:${s.winRatio || 0}%"></div>
            </div>
            <p>${s.winRatio}% Wins</p>
          </div>
        `;

        document.getElementById('statsBox').innerHTML = html;
      } else {
        document.getElementById('statsBox').innerHTML =
          `<p style="color:var(--subtext)">No stats available yet. Play some games to see progress!</p>`;
      }

    } catch (err) {
      console.error('Stats load error:', err);
    }
  }

  loadStats();
  </script>

</body>
</html>
