<!DOCTYPE html>
<html>
<head>
<title>Wishlist - The GameParkour</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="navbar">
  <div class="logo">
    <img src="logo.jpg">
    <span>The GameParkour</span>
  </div>
  <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="profile.html">Profile</a>
    <a href="collection.html">Collection</a>
    <a class="active" href="wishlist.html">Wishlist</a>
    <a href="stats.html">Stats</a>
    <a id="authLink" href="login.html">Login</a>
  </div>
</div>

<div class="page">

  <h2>Your Wishlist</h2>
  <div id="wishlist" class="grid"></div>

  <h3 style="margin-top:25px;">Add to Wishlist</h3>

  <form id="wishForm" class="form-box" style="max-width:350px;">
    <input id="wishTitle" placeholder="Game Title" required>
    <input id="wishGenre" placeholder="Genre">
    <input id="wishRelease" placeholder="Expected Release (optional)">
    <button class="btn" type="submit">Add</button>
  </form>

</div>

<div class="footer">© 2025 The GameParkour</div>

<script>
// ---------------- AUTH LINK (Login → Logout) ----------------
async function checkAuth() {
  const res = await fetch("/api/profile");
  const link = document.getElementById("authLink");

  if (res.status === 200) {
    link.textContent = "Logout";
    link.href = "#";
    link.onclick = async () => {
      await fetch("/api/logout", { method: "POST" });
      window.location = "login.html";
    };
  } else {
    link.textContent = "Login";
    link.href = "login.html";
  }
}
checkAuth();


// ---------------- LOAD WISHLIST ----------------
async function loadWishlist() {
  const res = await fetch('/api/wishlist');
  if (res.status === 401) {
    window.location = 'login.html';
    return;
  }

  const data = await res.json();
  const list = document.getElementById("wishlist");
  list.innerHTML = "";

  // SERVER returns { ok: true, wishlist: rows }
  const items = data.wishlist || [];

  if (items.length === 0) {
    list.innerHTML = `<p style="color:#bfc7d1">Your wishlist is empty.</p>`;
    return;
  }

  items.forEach(w => {
    const div = document.createElement("div");
    div.className = "card";
    div.style.position = "relative";
    div.style.paddingBottom = "30px";

    div.innerHTML = `
      <h3>${w.title}</h3>
      <p>${w.genre || "No genre"}</p>
      <p style="font-size:0.8rem; color:#bfc7d1;">Release: ${w.expected_release || "Unknown"}</p>

      <button class="btn deleteBtn"
        data-id="${w.id}"
        style="position:absolute; bottom:8px; right:10px; padding:5px 12px;">
        Delete
      </button>
    `;

    list.appendChild(div);
  });

  document.querySelectorAll(".deleteBtn").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.getAttribute("data-id");

      const res = await fetch(`/api/wishlist/${id}`, {
        method: "DELETE"
      });

      if (res.ok) loadWishlist();
      else alert("Delete error");
    };
  });
}


// ---------------- ADD TO WISHLIST ----------------
document.getElementById("wishForm").addEventListener("submit", async e => {
  e.preventDefault();

  const title = document.getElementById("wishTitle").value;
  const genre = document.getElementById("wishGenre").value;
  const expected_release = document.getElementById("wishRelease").value;

  const res = await fetch("/api/wishlist", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, genre, expected_release })
  });

  if (res.ok) {
    document.getElementById("wishForm").reset();
    loadWishlist();
  } else {
    alert("Error adding wishlist item");
  }
});

loadWishlist();
</script>

</body>
</html>
